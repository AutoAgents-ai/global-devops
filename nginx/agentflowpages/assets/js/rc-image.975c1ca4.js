import{c as $,e as E,b as Q,k as Ce,g as fe,f as Ve,d as $e}from"./@babel.fdde90cc.js";import{c as le}from"./classnames.087671f5.js";import{o as Ke,k as je,G as De,H as ge,K as ke,p as Me,I as Ge}from"./rc-util.402b0550.js";import{r as n,a as ue}from"./react.4ec6b4a2.js";import{D as Ue}from"./rc-dialog.4c9d83d5.js";import"./react-is.e5978b8b.js";import{P as Be}from"./@rc-component.435ec8bc.js";import{C as qe}from"./rc-motion.da861633.js";var Ne=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"],Re=n.createContext(null),Xe=0;function Je(i,e){var o=n.useState(function(){return Xe+=1,String(Xe)}),u=$(o,1),s=u[0],t=n.useContext(Re),v={data:e,canPreview:i};return n.useEffect(function(){if(t)return t.register(s,v)},[]),n.useEffect(function(){t&&t.register(s,v)},[i,e]),s}function Qe(i){return new Promise(function(e){var o=document.createElement("img");o.onerror=function(){return e(!1)},o.onload=function(){return e(!0)},o.src=i})}function Ze(i){var e=i.src,o=i.isCustomPlaceholder,u=i.fallback,s=n.useState(o?"loading":"normal"),t=$(s,2),v=t[0],r=t[1],c=n.useRef(!1),l=v==="error";n.useEffect(function(){var C=!0;return Qe(e).then(function(h){!h&&C&&r("error")}),function(){C=!1}},[e]),n.useEffect(function(){o&&!c.current?r("loading"):l&&r("normal")},[e]);var p=function(){r("normal")},m=function(h){c.current=!1,v==="loading"&&h!==null&&h!==void 0&&h.complete&&(h.naturalWidth||h.naturalHeight)&&(c.current=!0,p())},P=l&&u?{src:u}:{onLoad:p,src:e};return[m,P,v]}var Ie={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function en(i,e,o,u){var s=n.useRef(null),t=n.useRef([]),v=n.useState(Ie),r=$(v,2),c=r[0],l=r[1],p=function(h){l(Ie),u&&!Ke(Ie,c)&&u({transform:Ie,action:h})},m=function(h,I){s.current===null&&(t.current=[],s.current=je(function(){l(function(w){var S=w;return t.current.forEach(function(k){S=E(E({},S),k)}),s.current=null,u==null||u({transform:S,action:I}),S})})),t.current.push(E(E({},c),h))},P=function(h,I,w,S,k){var Y=i.current,y=Y.width,a=Y.height,x=Y.offsetWidth,d=Y.offsetHeight,f=Y.offsetLeft,R=Y.offsetTop,b=h,g=c.scale*h;g>o?(g=o,b=o/c.scale):g<e&&(g=k?g:e,b=g/c.scale);var M=w??innerWidth/2,O=S??innerHeight/2,N=b-1,D=N*y*.5,F=N*a*.5,H=N*(M-c.x-f),Z=N*(O-c.y-R),V=c.x-(H-D),K=c.y-(Z-F);if(h<1&&g===1){var G=x*g,U=d*g,ee=De(),oe=ee.width,z=ee.height;G<=oe&&U<=z&&(V=0,K=0)}m({x:V,y:K,scale:g},I)};return{transform:c,resetTransform:p,updateTransform:m,dispatchZoomChange:P}}function Oe(i,e,o,u){var s=e+o,t=(o-u)/2;if(o>u){if(e>0)return Q({},i,t);if(e<0&&s<u)return Q({},i,-t)}else if(e<0||s>u)return Q({},i,e<0?t:-t);return{}}function ze(i,e,o,u){var s=De(),t=s.width,v=s.height,r=null;return i<=t&&e<=v?r={x:0,y:0}:(i>t||e>v)&&(r=E(E({},Oe("x",o,i,t)),Oe("y",u,e,v))),r}var he=1,nn=1;function tn(i,e,o,u,s,t,v){var r=s.rotate,c=s.scale,l=s.x,p=s.y,m=n.useState(!1),P=$(m,2),C=P[0],h=P[1],I=n.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),w=function(a){!e||a.button!==0||(a.preventDefault(),a.stopPropagation(),I.current={diffX:a.pageX-l,diffY:a.pageY-p,transformX:l,transformY:p},h(!0))},S=function(a){o&&C&&t({x:a.pageX-I.current.diffX,y:a.pageY-I.current.diffY},"move")},k=function(){if(o&&C){h(!1);var a=I.current,x=a.transformX,d=a.transformY,f=l!==x&&p!==d;if(!f)return;var R=i.current.offsetWidth*c,b=i.current.offsetHeight*c,g=i.current.getBoundingClientRect(),M=g.left,O=g.top,N=r%180!==0,D=ze(N?b:R,N?R:b,M,O);D&&t(E({},D),"dragRebound")}},Y=function(a){if(!(!o||a.deltaY==0)){var x=Math.abs(a.deltaY/100),d=Math.min(x,nn),f=he+d*u;a.deltaY>0&&(f=he/f),v(f,"wheel",a.clientX,a.clientY)}};return n.useEffect(function(){var y,a,x,d;if(e){x=ge(window,"mouseup",k,!1),d=ge(window,"mousemove",S,!1);try{window.top!==window.self&&(y=ge(window.top,"mouseup",k,!1),a=ge(window.top,"mousemove",S,!1))}catch{}}return function(){var f,R,b,g;(f=x)===null||f===void 0||f.remove(),(R=d)===null||R===void 0||R.remove(),(b=y)===null||b===void 0||b.remove(),(g=a)===null||g===void 0||g.remove()}},[o,C,l,p,r,e]),{isMoving:C,onMouseDown:w,onMouseMove:S,onMouseUp:k,onWheel:Y}}function Te(i,e){var o=i.x-e.x,u=i.y-e.y;return Math.hypot(o,u)}function on(i,e,o,u){var s=Te(i,o),t=Te(e,u);if(s===0&&t===0)return[i.x,i.y];var v=s/(s+t),r=i.x+v*(e.x-i.x),c=i.y+v*(e.y-i.y);return[r,c]}function an(i,e,o,u,s,t,v){var r=s.rotate,c=s.scale,l=s.x,p=s.y,m=n.useState(!1),P=$(m,2),C=P[0],h=P[1],I=n.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),w=function(a){I.current=E(E({},I.current),a)},S=function(a){if(e){a.stopPropagation(),h(!0);var x=a.touches,d=x===void 0?[]:x;d.length>1?w({point1:{x:d[0].clientX,y:d[0].clientY},point2:{x:d[1].clientX,y:d[1].clientY},eventType:"touchZoom"}):w({point1:{x:d[0].clientX-l,y:d[0].clientY-p},eventType:"move"})}},k=function(a){var x=a.touches,d=x===void 0?[]:x,f=I.current,R=f.point1,b=f.point2,g=f.eventType;if(d.length>1&&g==="touchZoom"){var M={x:d[0].clientX,y:d[0].clientY},O={x:d[1].clientX,y:d[1].clientY},N=on(R,b,M,O),D=$(N,2),F=D[0],H=D[1],Z=Te(M,O)/Te(R,b);v(Z,"touchZoom",F,H,!0),w({point1:M,point2:O,eventType:"touchZoom"})}else g==="move"&&(t({x:d[0].clientX-R.x,y:d[0].clientY-R.y},"move"),w({eventType:"move"}))},Y=function(){if(o){if(C&&h(!1),w({eventType:"none"}),u>c)return t({x:0,y:0,scale:u},"touchZoom");var a=i.current.offsetWidth*c,x=i.current.offsetHeight*c,d=i.current.getBoundingClientRect(),f=d.left,R=d.top,b=r%180!==0,g=ze(b?x:a,b?a:x,f,R);g&&t(E({},g),"dragRebound")}};return n.useEffect(function(){var y;return o&&e&&(y=ge(window,"touchmove",function(a){return a.preventDefault()},{passive:!1})),function(){var a;(a=y)===null||a===void 0||a.remove()}},[o,e]),{isTouching:C,onTouchStart:S,onTouchMove:k,onTouchEnd:Y}}var rn=function(e){var o=e.visible,u=e.maskTransitionName,s=e.getContainer,t=e.prefixCls,v=e.rootClassName,r=e.icons,c=e.countRender,l=e.showSwitch,p=e.showProgress,m=e.current,P=e.transform,C=e.count,h=e.scale,I=e.minScale,w=e.maxScale,S=e.closeIcon,k=e.onSwitchLeft,Y=e.onSwitchRight,y=e.onClose,a=e.onZoomIn,x=e.onZoomOut,d=e.onRotateRight,f=e.onRotateLeft,R=e.onFlipX,b=e.onFlipY,g=e.toolbarRender,M=e.zIndex,O=n.useContext(Re),N=r.rotateLeft,D=r.rotateRight,F=r.zoomIn,H=r.zoomOut,Z=r.close,V=r.left,K=r.right,G=r.flipX,U=r.flipY,ee="".concat(t,"-operations-operation");n.useEffect(function(){var _=function(T){T.keyCode===ke.ESC&&y()};return o&&window.addEventListener("keydown",_),function(){window.removeEventListener("keydown",_)}},[o]);var oe=[{icon:U,onClick:b,type:"flipY"},{icon:G,onClick:R,type:"flipX"},{icon:N,onClick:f,type:"rotateLeft"},{icon:D,onClick:d,type:"rotateRight"},{icon:H,onClick:x,type:"zoomOut",disabled:h<=I},{icon:F,onClick:a,type:"zoomIn",disabled:h===w}],z=oe.map(function(_){var X,T=_.icon,J=_.onClick,W=_.type,A=_.disabled;return n.createElement("div",{className:le(ee,(X={},Q(X,"".concat(t,"-operations-operation-").concat(W),!0),Q(X,"".concat(t,"-operations-operation-disabled"),!!A),X)),onClick:J,key:W},T)}),j=n.createElement("div",{className:"".concat(t,"-operations")},z);return n.createElement(qe,{visible:o,motionName:u},function(_){var X=_.className,T=_.style;return n.createElement(Be,{open:!0,getContainer:s??document.body},n.createElement("div",{className:le("".concat(t,"-operations-wrapper"),X,v),style:E(E({},T),{},{zIndex:M})},S===null?null:n.createElement("button",{className:"".concat(t,"-close"),onClick:y},S||Z),l&&n.createElement(n.Fragment,null,n.createElement("div",{className:le("".concat(t,"-switch-left"),Q({},"".concat(t,"-switch-left-disabled"),m===0)),onClick:k},V),n.createElement("div",{className:le("".concat(t,"-switch-right"),Q({},"".concat(t,"-switch-right-disabled"),m===C-1)),onClick:Y},K)),n.createElement("div",{className:"".concat(t,"-footer")},p&&n.createElement("div",{className:"".concat(t,"-progress")},c?c(m+1,C):"".concat(m+1," / ").concat(C)),g?g(j,E({icons:{flipYIcon:z[0],flipXIcon:z[1],rotateLeftIcon:z[2],rotateRightIcon:z[3],zoomOutIcon:z[4],zoomInIcon:z[5]},actions:{onFlipY:b,onFlipX:R,onRotateLeft:f,onRotateRight:d,onZoomOut:x,onZoomIn:a},transform:P},O?{current:m,total:C}:{})):j)))})},sn=["fallback","src","imgRef"],cn=["prefixCls","src","alt","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],ln=function(e){var o=e.fallback,u=e.src,s=e.imgRef,t=Ce(e,sn),v=Ze({src:u,fallback:o}),r=$(v,2),c=r[0],l=r[1];return ue.createElement("img",fe({ref:function(m){s.current=m,c(m)}},t,l))},Fe=function(e){var o=e.prefixCls,u=e.src,s=e.alt,t=e.fallback,v=e.movable,r=v===void 0?!0:v,c=e.onClose,l=e.visible,p=e.icons,m=p===void 0?{}:p,P=e.rootClassName,C=e.closeIcon,h=e.getContainer,I=e.current,w=I===void 0?0:I,S=e.count,k=S===void 0?1:S,Y=e.countRender,y=e.scaleStep,a=y===void 0?.5:y,x=e.minScale,d=x===void 0?1:x,f=e.maxScale,R=f===void 0?50:f,b=e.transitionName,g=b===void 0?"zoom":b,M=e.maskTransitionName,O=M===void 0?"fade":M,N=e.imageRender,D=e.imgCommonProps,F=e.toolbarRender,H=e.onTransform,Z=e.onChange,V=Ce(e,cn),K=n.useRef(),G=n.useContext(Re),U=G&&k>1,ee=G&&k>=1,oe=n.useState(!0),z=$(oe,2),j=z[0],_=z[1],X=en(K,d,R,H),T=X.transform,J=X.resetTransform,W=X.updateTransform,A=X.dispatchZoomChange,re=tn(K,r,l,a,T,W,A),we=re.isMoving,ve=re.onMouseDown,pe=re.onWheel,B=an(K,r,l,d,T,W,A),ne=B.isTouching,te=B.onTouchStart,ie=B.onTouchMove,ae=B.onTouchEnd,Se=T.rotate,me=T.scale,de=le(Q({},"".concat(o,"-moving"),we));n.useEffect(function(){j||_(!0)},[j]);var Pe=function(){J("close")},_e=function(){A(he+a,"zoomIn")},Ee=function(){A(he/(he+a),"zoomOut")},se=function(){W({rotate:Se+90},"rotateRight")},ce=function(){W({rotate:Se-90},"rotateLeft")},be=function(){W({flipX:!T.flipX},"flipX")},ye=function(){W({flipY:!T.flipY},"flipY")},xe=function(L){L==null||L.preventDefault(),L==null||L.stopPropagation(),w>0&&(_(!1),J("prev"),Z==null||Z(w-1,w))},Le=function(L){L==null||L.preventDefault(),L==null||L.stopPropagation(),w<k-1&&(_(!1),J("next"),Z==null||Z(w+1,w))},Ae=function(L){!l||!U||(L.keyCode===ke.LEFT?xe():L.keyCode===ke.RIGHT&&Le())},He=function(L){l&&(me!==1?W({x:0,y:0,scale:1},"doubleClick"):A(he+a,"doubleClick",L.clientX,L.clientY))};n.useEffect(function(){var q=ge(window,"keydown",Ae,!1);return function(){q.remove()}},[l,U,w]);var Ye=ue.createElement(ln,fe({},D,{width:e.width,height:e.height,imgRef:K,className:"".concat(o,"-img"),alt:s,style:{transform:"translate3d(".concat(T.x,"px, ").concat(T.y,"px, 0) scale3d(").concat(T.flipX?"-":"").concat(me,", ").concat(T.flipY?"-":"").concat(me,", 1) rotate(").concat(Se,"deg)"),transitionDuration:(!j||ne)&&"0s"},fallback:t,src:u,onWheel:pe,onMouseDown:ve,onDoubleClick:He,onTouchStart:te,onTouchMove:ie,onTouchEnd:ae,onTouchCancel:ae}));return ue.createElement(ue.Fragment,null,ue.createElement(Ue,fe({transitionName:g,maskTransitionName:O,closable:!1,keyboard:!0,prefixCls:o,onClose:c,visible:l,classNames:{wrapper:de},rootClassName:P,getContainer:h},V,{afterClose:Pe}),ue.createElement("div",{className:"".concat(o,"-img-wrapper")},N?N(Ye,E({transform:T},G?{current:w}:{})):Ye)),ue.createElement(rn,{visible:l,transform:T,maskTransitionName:O,closeIcon:C,getContainer:h,prefixCls:o,rootClassName:P,icons:m,countRender:Y,showSwitch:U,showProgress:ee,current:w,count:k,scale:me,minScale:d,maxScale:R,toolbarRender:F,onSwitchLeft:xe,onSwitchRight:Le,onZoomIn:_e,onZoomOut:Ee,onRotateRight:se,onRotateLeft:ce,onFlipX:be,onFlipY:ye,onClose:c,zIndex:V.zIndex!==void 0?V.zIndex+1:void 0}))};function un(i){var e=n.useState({}),o=$(e,2),u=o[0],s=o[1],t=n.useCallback(function(r,c){return s(function(l){return E(E({},l),{},Q({},r,c))}),function(){s(function(l){var p=E({},l);return delete p[r],p})}},[]),v=n.useMemo(function(){return i?i.map(function(r){if(typeof r=="string")return{data:{src:r}};var c={};return Object.keys(r).forEach(function(l){["src"].concat(Ve(Ne)).includes(l)&&(c[l]=r[l])}),{data:c}}):Object.keys(u).reduce(function(r,c){var l=u[c],p=l.canPreview,m=l.data;return p&&r.push({data:m,id:c}),r},[])},[i,u]);return[v,t]}var fn=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],vn=["src"],mn=function(e){var o,u=e.previewPrefixCls,s=u===void 0?"rc-image-preview":u,t=e.children,v=e.icons,r=v===void 0?{}:v,c=e.items,l=e.preview,p=e.fallback,m=$e(l)==="object"?l:{},P=m.visible,C=m.onVisibleChange,h=m.getContainer,I=m.current,w=m.movable,S=m.minScale,k=m.maxScale,Y=m.countRender,y=m.closeIcon,a=m.onChange,x=m.onTransform,d=m.toolbarRender,f=m.imageRender,R=Ce(m,fn),b=un(c),g=$(b,2),M=g[0],O=g[1],N=Me(0,{value:I}),D=$(N,2),F=D[0],H=D[1],Z=n.useState(!1),V=$(Z,2),K=V[0],G=V[1],U=((o=M[F])===null||o===void 0?void 0:o.data)||{},ee=U.src,oe=Ce(U,vn),z=Me(!!P,{value:P,onChange:function(ne,te){C==null||C(ne,te,F)}}),j=$(z,2),_=j[0],X=j[1],T=n.useState(null),J=$(T,2),W=J[0],A=J[1],re=n.useCallback(function(B,ne,te){var ie=M.findIndex(function(ae){return ae.id===B});X(!0),A({x:ne,y:te}),H(ie<0?0:ie),G(!0)},[M]);n.useEffect(function(){_?K||H(0):G(!1)},[_]);var we=function(ne,te){H(ne),a==null||a(ne,te)},ve=function(){X(!1),A(null)},pe=n.useMemo(function(){return{register:O,onPreview:re}},[O,re]);return n.createElement(Re.Provider,{value:pe},t,n.createElement(Fe,fe({"aria-hidden":!_,movable:w,visible:_,prefixCls:s,closeIcon:y,onClose:ve,mousePosition:W,imgCommonProps:oe,src:ee,fallback:p,icons:r,minScale:S,maxScale:k,getContainer:h,current:F,count:M.length,countRender:Y,onTransform:x,toolbarRender:d,imageRender:f,onChange:we},R)))},dn=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],gn=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],We=function(e){var o=e.src,u=e.alt,s=e.onPreviewClose,t=e.prefixCls,v=t===void 0?"rc-image":t,r=e.previewPrefixCls,c=r===void 0?"".concat(v,"-preview"):r,l=e.placeholder,p=e.fallback,m=e.width,P=e.height,C=e.style,h=e.preview,I=h===void 0?!0:h,w=e.className,S=e.onClick,k=e.onError,Y=e.wrapperClassName,y=e.wrapperStyle,a=e.rootClassName,x=Ce(e,dn),d=l&&l!==!0,f=$e(I)==="object"?I:{},R=f.src,b=f.visible,g=b===void 0?void 0:b,M=f.onVisibleChange,O=M===void 0?s:M,N=f.getContainer,D=N===void 0?void 0:N,F=f.mask,H=f.maskClassName,Z=f.movable,V=f.icons,K=f.scaleStep,G=f.minScale,U=f.maxScale,ee=f.imageRender,oe=f.toolbarRender,z=Ce(f,gn),j=R??o,_=Me(!!g,{value:g,onChange:O}),X=$(_,2),T=X[0],J=X[1],W=Ze({src:o,isCustomPlaceholder:d,fallback:p}),A=$(W,3),re=A[0],we=A[1],ve=A[2],pe=n.useState(null),B=$(pe,2),ne=B[0],te=B[1],ie=n.useContext(Re),ae=!!I,Se=function(){J(!1),te(null)},me=le(v,Y,a,Q({},"".concat(v,"-error"),ve==="error")),de=n.useMemo(function(){var se={};return Ne.forEach(function(ce){e[ce]!==void 0&&(se[ce]=e[ce])}),se},Ne.map(function(se){return e[se]})),Pe=n.useMemo(function(){return E(E({},de),{},{src:j})},[j,de]),_e=Je(ae,Pe),Ee=function(ce){var be=Ge(ce.target),ye=be.left,xe=be.top;ie?ie.onPreview(_e,ye,xe):(te({x:ye,y:xe}),J(!0)),S==null||S(ce)};return n.createElement(n.Fragment,null,n.createElement("div",fe({},x,{className:me,onClick:ae?Ee:S,style:E({width:m,height:P},y)}),n.createElement("img",fe({},de,{className:le("".concat(v,"-img"),Q({},"".concat(v,"-img-placeholder"),l===!0),w),style:E({height:P},C),ref:re},we,{width:m,height:P,onError:k})),ve==="loading"&&n.createElement("div",{"aria-hidden":"true",className:"".concat(v,"-placeholder")},l),F&&ae&&n.createElement("div",{className:le("".concat(v,"-mask"),H),style:{display:(C==null?void 0:C.display)==="none"?"none":void 0}},F)),!ie&&ae&&n.createElement(Fe,fe({"aria-hidden":!T,visible:T,prefixCls:c,onClose:Se,mousePosition:ne,src:j,alt:u,fallback:p,getContainer:D,icons:V,movable:Z,scaleStep:K,minScale:G,maxScale:U,rootClassName:a,imageRender:ee,imgCommonProps:de,toolbarRender:oe},z)))};We.PreviewGroup=mn;We.displayName="Image";export{We as I};
