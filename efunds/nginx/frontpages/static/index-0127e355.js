import{H as V,aJ as q,ah as w,l as o,m as d,p as t,V as l,P as U,F as b,a8 as N,u as J,J as M,aG as W,r as k,e as Z,d as H,T as P,U as E,O as $,S as T,aD as j,aE as z,a3 as F,c as O}from"./vue-82a6b7fc.js";import{u as B,a as ee,b as te,d as ae,C as ne}from"./index-6b2e9c20.js";import{_ as Y,f as se}from"./index-d6981835.js";import{e as oe}from"./element-fdd395f7.js";import{l as ie}from"./agent-cd2ce457.js";import"./agent-9741e7dd.js";import"./index-a3cec3d6.js";import"./steer-08946f55.js";import"./vxe-891d1ddd.js";const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBzVg9bNNQEP5eYOkPUiSK2gkZCQk22q7NkA6FbgWVhYkgYGJATF2AthudiIANqjQLLCDajR+JGqldqbtRCYRhAgmkDBQmKPfl2cFxnh07adJ+0sXOy8n35e7evTsrpES+sGPJZUpkmF9Fsp4QFRHXE1tkxV5SLlJAJVUUIgW5XPRIpIEjVop2SZWTKDclJETycimJWGgPrliba0ZMxRBhGOZErmN3URSZl1BWkJSQlyfPofOkE3BFxk35pSLIrKL9EDWDCwMpFSLDMG10gYwPxyNVC18mpDDXRTIEU2I2uFDzkLetS9gb0Es2bw4GFmdNmv29Wkz4+UtLEEMDyXUDoCOO8abqoTjvTJ8Gzk+Yn0LjznugvAKMjQCTuf/GTYSuziIaCgXWKN9DkbVmUwxuGwx8/Q58+CJERoGZy/r7ldvAoT7g+FEzoVjsoCCfZeVt809RevRQbqRx3Q9leVm8tAU8nNek6DUSNRG6dR+xyByARQ9NxSl9lIf39zSub25pAndnxNgT4Okr7Rka5R/o620k1Ax//+Ast30+TsmU0FxjmJgzC4vAtQvAy3XZwye1pwYH0CqG6SErTmPtnZYwnr3WxpnUVdI7+vrgsf6tReQzaLEQMlwkOni4PhxtkCGyJJTF/kE2g30GEqqgRURV8DZQaZkQ602wAA4d0fUnN4p24HKX2SKFKA1u5VMn6tfoGd8w75ncPDpYAliXeM+kD4KJnyDhXXrIidMwhYUPv/NIGyAx/0ryPK/CZFLApofkaKz2uZGEaCgMEmDYSI4F8saC9s70hJlQQpIr/mnPljVv0qDRcMh8A99+yFw0pQm9WNOnPuuSqWUh8fUNxMGRnmjEP+3LUYQmx4AzOfMT/Pbj5j3tMVZu33gYTQkpHaVgx8gT3wrr8Z/29Zifsf270Tg9FAV6NAKueKfaoAU7xkvQ00YdmnR6aYxGQ1V7+SpqldrraYvoPurG7PDRwSxw0D24ns0a6gh589E5T7EbZMbDI3XD4epNkuPoLCl/QHTDPxhPe0+RnXQncqoYRYZI8jqmAD2zWWgPrpJRZ7Wk3sYppX1hxXEp7RsRW6ws7doLKzQSs6AnlTy01yjBV3oV6A7CkbFm+c2i+owU+AdOuB7Rr1KudAAAAABJRU5ErkJggg==",ce={class:"aside-angent"},de={class:"agent-box"},le=["onClick"],ue=["src"],ge=V({__name:"Aside",props:{agentId:{}},setup(h){const{agentHistory:A}=B(),I=q(),y=i=>{I.push({name:"dialogue",query:{agentId:i}})},u=()=>{I.push({path:"/"})};return(i,p)=>{const g=w("svg-icon"),v=w("el-scrollbar");return o(),d("div",ce,[t("div",{class:"logo-box"},[t("img",{src:re,class:"logo",onClick:u})]),t("div",de,[l(v,null,{default:U(()=>[(o(!0),d(b,null,N(J(A),r=>(o(),d("div",{class:M(["item",{active:i.agentId==r.agentId}]),key:r.agentId,onClick:C=>y(r.agentId)},[t("img",{src:r.avatar,class:"agent-logo"},null,8,ue),l(g,{name:"agent-active",class:"agent-active"})],10,le))),128))]),_:1})])])}}});const pe=Y(ge,[["__scopeId","data-v-8f59ddf0"]]),_e=h=>(j("data-v-1ee1ec4a"),h=h(),z(),h),me={class:"dialogue-history"},he={class:"dialogue-header"},Ae={class:"history-list"},ve={key:0,class:"create"},fe=_e(()=>t("span",null,"新的对话",-1)),Ie=["onClick"],ye={class:"more"},ke={class:"item-dropdown"},we={class:"dropdown-menu"},Ce=["onClick"],De=["onClick"],Re=V({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(h,{expose:A,emit:I}){const y=I,u=h,i=q(),p=W(),g=k([]),v=Z(()=>p.query.chatId||""),r=async()=>{const{data:a}=await ee({agentUUid:u.agentId});g.value=_(a)},C=a=>{y("refreshHistory"),i.push({name:"dialogue",query:{agentId:u.agentId,chatId:a.id}})};function _(a){const D=new Date,R=new Date(D.getTime()-6*24*60*60*1e3),S=a.reduce((s,m)=>{const n=new Date(m.createAt),f=`${n.getFullYear()}-${n.getMonth()+1}`;return n>=R&&n<=D?(s.近7天||(s.近7天=[]),s.近7天.push(m)):(s[f]||(s[f]=[]),s[f].push(m)),s},{});return Object.entries(S).map(([s,m])=>{const n=s==="近7天",f=!n;let c="";if(n)c="近7天";else if(f){const[x,L]=s.split("-").map(Number),X=new Date().getFullYear();x!==X?c=`${x}年${L}月`:c=`${L}月`}return{title:c,items:m}})}const e=()=>{i.push({name:"dialogue",query:{agentId:u.agentId}})},Q=a=>{oe.prompt("","自定义历史会话标题",{}).then(async D=>{await te({chatId:a.id,customTitle:D.value,top:!1}),r()})},K=async a=>{await ae({chatId:a.id}),i.push({name:"dialogue",query:{agentId:u.agentId}})};return H(()=>u.agentId,a=>{a&&r()},{immediate:!0}),A({getAgentChatHistory:r}),(a,D)=>{var m;const R=w("svg-icon"),S=w("el-text"),G=w("el-popover"),s=w("el-scrollbar");return o(),d("div",me,[t("div",he,[t("h3",null,[P(E((m=a.agentInfo)==null?void 0:m.name)+" ",1),v.value?(o(),$(R,{key:0,name:"Edit",class:"edit-icon",onClick:e})):T("",!0)]),t("p",null,[l(S,{"line-clamp":2},{default:U(()=>{var n;return[P(E((n=a.agentInfo)==null?void 0:n.intro),1)]}),_:1})])]),t("div",Ae,[v.value?T("",!0):(o(),d("div",ve,[l(R,{name:"new-dialogue",class:"create-icon"}),fe])),l(s,null,{default:U(()=>[(o(!0),d(b,null,N(g.value,(n,f)=>(o(),d("div",{class:"list",key:f},[t("h4",null,E(n.title),1),(o(!0),d(b,null,N(n.items,c=>(o(),d("div",{class:M(["item",{active:v.value==c.id}]),key:c.id,onClick:x=>C(c)},[t("span",null,E(c.title),1),t("div",ye,[l(G,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:U(()=>[t("div",ke,[l(R,{name:"more",class:"more-icon"})])]),default:U(()=>[t("div",we,[t("div",{class:"dropdown-item",onClick:F(x=>Q(c),["stop"])},"自定义标题",8,Ce),t("div",{class:"dropdown-item del",onClick:F(x=>K(c),["stop"])},"删除",8,De)])]),_:2},1024)])],10,Ie))),128))]))),128))]),_:1})])])}}});const xe=Y(Re,[["__scopeId","data-v-1ee1ec4a"]]),Ue={class:"dialogue-container"},Ee={key:0,class:"aside-container"},Qe=V({__name:"index",setup(h){const A=W(),{setAgentHistory:I}=B(),y=k();let u=k("");const i=k();let p=k(!0);const g=k(""),v=Z(()=>A.query.chatId||""),r=async _=>{const{data:e}=await ie(_);e.background&&(u.value=e.background),se.set("agentUuid",e.agentUuid),e.uuid=e.agentUuid,g.value=e.agentUuid,e.guides=e.guides.map(Q=>({guide:Q})),i.value=e,I({avatar:e==null?void 0:e.avatar,name:e==null?void 0:e.name,agentId:e.agentUuid})};O(()=>{window.innerWidth<=1200?p.value=!1:window.innerWidth>1200&&(p.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?p.value=!1:window.innerWidth>1200&&(p.value=!0)})});const C=()=>{y.value.getAgentChatHistory()};return H(()=>[A.query.hash,A.query.agentId],_=>{_[0]?r({hash:_[0]}):r({agentUUid:_[1]})},{immediate:!0}),(_,e)=>(o(),d("div",Ue,[J(p)===!0?(o(),d("div",Ee,[l(pe,{agentId:g.value},null,8,["agentId"]),l(xe,{ref_key:"dialogueListRef",ref:y,agentInfo:i.value,agentId:g.value,onRefreshHistory:C},null,8,["agentInfo","agentId"])])):T("",!0),l(ne,{class:"chat-container",agentId:g.value,chatId:v.value,agentData:i.value,onRefreshHistory:C},null,8,["agentId","chatId","agentData"])]))}});const Fe=Y(Qe,[["__scopeId","data-v-0ef0105e"]]);export{Fe as default};
