import{H as ue,aD as pe,r,_ as E,ah as i,l as c,m as f,p as n,V as t,P as o,F as $,a8 as F,a3 as D,O as b,aE as me,aF as _e,u as O,U as R,T as ve,J as fe,S as ge}from"./vue-25cdfb55.js";import{D as A}from"./index-8f865d99.js";import{g as he,G as be,a as Ce,s as ke,K as we,d as ye}from"./index-37c5f637.js";import{u as xe,a as G,b as Ve}from"./knowledge-ff2d2de5.js";import{h as Ue,f as Ie}from"./element-e5236e8d.js";import{_ as $e}from"./index-32bfe802.js";import"./vxe-9027ceee.js";const Fe=g=>(me("data-v-a7e71e9f"),g=g(),_e(),g),De={class:"app-container"},Me={class:"app-list"},Ne={class:"app-list-box"},Ke={class:"add-icon"},Se=Fe(()=>n("h3",null,"创建知识库",-1)),je=["onClick"],Be={class:"image-slot"},ze={class:"item-dropdown"},Te={class:"dropdown-menu"},Pe=["onClick"],qe=["onClick"],Ee={class:"avatar"},Oe=["onClick"],Re=["src"],Ae=["onClick","src"],Ge=ue({__name:"index",setup(g){const{proxy:C}=xe(),k=pe(),p=r(!1),w=r(!0),M=r(0),d=r(0),y=r(),N=r(),J=r(),K=r(0),m=r(!1),x=r(!1),S=r("创建知识库"),L={pageNum:1,pageSize:1e4,count:!0,keywords:"",parentId:0},j=r([]),l=E({parentId:0,name:"",vectorModel:"SkyChat-MegaVerse",avatarUrl:"https://autoagents.oss-cn-beijing.aliyuncs.com/static/avatar/18.png",tags:[],type:"kb",description:""}),Q=E({name:[{required:!0,message:"请填写知识库名称!",trigger:"blur"}],description:[{required:!0,message:"请填写知识库描述!",trigger:"blur"}]}),V=async(s=!1)=>{he(L).then(async a=>{if(j.value=a.data.list,s){const u=a.data.list.filter(_=>_.id==K.value);await G().setChatData(u[0]),await k.push({name:"importData"})}})};V();const B=()=>{be("emb_models").then(s=>{N.value=s.data})};B();const H=()=>{p.value=!0,w.value=!0,l.avatarUrl="https://autoagents.oss-cn-beijing.aliyuncs.com/static/avatar/18.png",x.value=!1},W=s=>{w.value=!1,p.value=!0,x.value=!0,M.value=s,S.value="知识库设置",we(s).then(a=>{let u;for(u in l)l.hasOwnProperty(u)&&(l[u]=a.data[u])})},X=s=>{Ie.confirm("此操作将永久删除数据,是否继续?","提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ye(s).then(()=>{V(),C.$message.success("删除成功!")})}).catch(()=>{})},Y=()=>{var a;const s=(a=l.avatarUrl)==null?void 0:a.match(/\/([^\/]+)\.[a-z]+$/i);s!=null&&s.length?d.value=Number(s[1]):d.value=0,m.value=!0},Z=s=>{d.value=s},ee=async()=>{await y.value.validate(async s=>{s&&(w.value?await Ce(l).then(a=>{K.value=a.data,C.$message.success("创建成功!")}):await ke(Object.assign(l,{id:M.value})).then(()=>{C.$message.success("修改成功!")}),await V(!0),await B(),await z(),p.value=!1)})},ae=()=>{l.avatarUrl=`https://autoagents.oss-cn-beijing.aliyuncs.com/static/avatar/${d.value}.${[4,12,16,20,22].includes(d.value)?"jpg":"png"}`,m.value=!1},z=()=>{y.value.resetFields()},te=()=>{d.value=0,m.value=!1},se=(s,a)=>{J.value=s,G().setChatData(a),a.dsNum<=1?k.push({name:"importData"}):k.push({name:"knowledgeTable"})};return(s,a)=>{const u=i("Plus"),_=i("el-icon"),U=i("el-col"),oe=i("el-image"),le=i("el-text"),T=i("svg-icon"),ne=i("el-popover"),P=i("el-row"),I=i("el-input"),h=i("el-form-item"),ie=i("el-option"),re=i("el-select"),ce=i("el-form"),de=i("CircleCheckFilled");return c(),f("div",null,[n("div",De,[n("div",Me,[n("div",Ne,[t(P,{gutter:24},{default:o(()=>[t(U,{span:6},{default:o(()=>[n("div",{class:"item add",onClick:H},[n("div",Ke,[t(_,{size:20},{default:o(()=>[t(u)]),_:1})]),Se])]),_:1}),(c(!0),f($,null,F(j.value,(e,v)=>(c(),b(U,{span:6,key:v},{default:o(()=>[n("div",{class:"item",onClick:q=>se(v,e)},[t(oe,{src:e.avatarUrl?e.avatarUrl:`${O(Ve)("")}`,class:"logo"},{error:o(()=>[n("div",Be,[t(_,{size:"40"},{default:o(()=>[t(O(Ue))]),_:1})])]),_:2},1032,["src"]),n("h3",null,R(e.name),1),n("p",null,[t(le,{"line-clamp":2},{default:o(()=>[ve(R(e.description),1)]),_:2},1024)]),t(ne,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:100,trigger:"hover",offset:0},{reference:o(()=>[n("div",ze,[t(T,{name:"more",class:"icon"})])]),default:o(()=>[n("div",Te,[n("div",{class:"dropdown-item",onClick:D(q=>W(e.id),["stop"])},"编辑",8,Pe),n("div",{class:"dropdown-item del",onClick:D(q=>X(e.id),["stop"])},"删除",8,qe)])]),_:2},1024)],8,je)]),_:2},1024))),128))]),_:1})])])]),t(A,{visible:p.value,"onUpdate:visible":a[4]||(a[4]=e=>p.value=e),title:S.value,confirmName:"确定",closeName:"取消",onConfirm:ee,onClose:z,width:"640px"},{main:o(()=>[n("div",Ee,[n("div",{class:"imgiconbox",onClick:D(Y,["stop"])},[l.avatarUrl?(c(),f("img",{key:1,src:l.avatarUrl,alt:""},null,8,Re)):(c(),b(T,{key:0,name:"ImgAdd",class:"imgaddicon"}))],8,Oe)]),t(ce,{ref_key:"ruleFormRef",ref:y,model:l,"status-icon":"",rules:Q,"label-position":"top","label-width":"80px",class:"demo-ruleForm"},{default:o(()=>[t(h,{label:"知识库名称",prop:"name"},{default:o(()=>[t(I,{modelValue:l.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.name=e),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),t(h,{label:"知识库描述",prop:"description"},{default:o(()=>[t(I,{modelValue:l.description,"onUpdate:modelValue":a[1]||(a[1]=e=>l.description=e),modelModifiers:{trim:!0},type:"textarea",rows:4,placeholder:"请输入对此知识库的描述"},null,8,["modelValue"])]),_:1}),t(h,{label:"索引模型",prop:"vectorModel"},{default:o(()=>[t(re,{modelValue:l.vectorModel,"onUpdate:modelValue":a[2]||(a[2]=e=>l.vectorModel=e),placeholder:"选择",disabled:x.value},{default:o(()=>[(c(!0),f($,null,F(N.value,(e,v)=>(c(),b(ie,{label:e.name,value:e.model,key:v},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(h,{label:"标签",prop:"tags"},{default:o(()=>[t(I,{modelValue:l.tags[0],"onUpdate:modelValue":a[3]||(a[3]=e=>l.tags[0]=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title"]),t(A,{visible:m.value,"onUpdate:visible":a[5]||(a[5]=e=>m.value=e),title:"选择头像",onConfirm:ae,onClose:te,width:"640px"},{main:o(()=>[t(P,{span:24,class:"avatrow"},{default:o(()=>[(c(),f($,null,F(41,e=>t(U,{key:e,span:4,gutter:12,class:"avatcol"},{default:o(()=>[n("img",{onClick:v=>Z(e),class:fe(["avatarImg",e==d.value?"active":""]),src:`https://autoagents.oss-cn-beijing.aliyuncs.com/static/avatar/${e}.${[4,12,16,20,22].includes(e)?"jpg":"png"}`,alt:""},null,10,Ae),e==d.value?(c(),b(_,{key:0,color:"#4060FF",size:"18px"},{default:o(()=>[t(de)]),_:1})):ge("",!0)]),_:2},1024)),64))]),_:1})]),_:1},8,["visible"])])}}});const Ze=$e(Ge,[["__scopeId","data-v-a7e71e9f"]]);export{Ze as default};
