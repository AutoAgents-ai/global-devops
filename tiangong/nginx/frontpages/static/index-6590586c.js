import{H as T,aJ as F,ah as w,l as c,m as d,p as t,V as l,P as U,F as b,a8 as N,u as q,J,aG as M,r as k,e as H,d as W,T as L,U as E,S as Z,aD as $,aE as j,a3 as P,c as z}from"./vue-3e7b265f.js";import{u as K,a as O,b as ee,d as te,C as ae}from"./index-f2a83c1e.js";import{_ as V}from"./index-ea96c4fc.js";import{f as ne}from"./element-f6a868e5.js";import{l as se}from"./agent-9e8218d7.js";import"./agent-a771df9c.js";import"./index-2a9b20e7.js";import"./steer-cd40041e.js";import"./vxe-49ae37d0.js";const oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBzVg9bNNQEP5eYOkPUiSK2gkZCQk22q7NkA6FbgWVhYkgYGJATF2AthudiIANqjQLLCDajR+JGqldqbtRCYRhAgmkDBQmKPfl2cFxnh07adJ+0sXOy8n35e7evTsrpES+sGPJZUpkmF9Fsp4QFRHXE1tkxV5SLlJAJVUUIgW5XPRIpIEjVop2SZWTKDclJETycimJWGgPrliba0ZMxRBhGOZErmN3URSZl1BWkJSQlyfPofOkE3BFxk35pSLIrKL9EDWDCwMpFSLDMG10gYwPxyNVC18mpDDXRTIEU2I2uFDzkLetS9gb0Es2bw4GFmdNmv29Wkz4+UtLEEMDyXUDoCOO8abqoTjvTJ8Gzk+Yn0LjznugvAKMjQCTuf/GTYSuziIaCgXWKN9DkbVmUwxuGwx8/Q58+CJERoGZy/r7ldvAoT7g+FEzoVjsoCCfZeVt809RevRQbqRx3Q9leVm8tAU8nNek6DUSNRG6dR+xyByARQ9NxSl9lIf39zSub25pAndnxNgT4Okr7Rka5R/o620k1Ax//+Ast30+TsmU0FxjmJgzC4vAtQvAy3XZwye1pwYH0CqG6SErTmPtnZYwnr3WxpnUVdI7+vrgsf6tReQzaLEQMlwkOni4PhxtkCGyJJTF/kE2g30GEqqgRURV8DZQaZkQ602wAA4d0fUnN4p24HKX2SKFKA1u5VMn6tfoGd8w75ncPDpYAliXeM+kD4KJnyDhXXrIidMwhYUPv/NIGyAx/0ryPK/CZFLApofkaKz2uZGEaCgMEmDYSI4F8saC9s70hJlQQpIr/mnPljVv0qDRcMh8A99+yFw0pQm9WNOnPuuSqWUh8fUNxMGRnmjEP+3LUYQmx4AzOfMT/Pbj5j3tMVZu33gYTQkpHaVgx8gT3wrr8Z/29Zifsf270Tg9FAV6NAKueKfaoAU7xkvQ00YdmnR6aYxGQ1V7+SpqldrraYvoPurG7PDRwSxw0D24ns0a6gh589E5T7EbZMbDI3XD4epNkuPoLCl/QHTDPxhPe0+RnXQncqoYRYZI8jqmAD2zWWgPrpJRZ7Wk3sYppX1hxXEp7RsRW6ws7doLKzQSs6AnlTy01yjBV3oV6A7CkbFm+c2i+owU+AdOuB7Rr1KudAAAAABJRU5ErkJggg==",ie={class:"aside-angent"},re={class:"agent-box"},ce=["onClick"],de=["src"],le=T({__name:"Aside",props:{agentId:{}},setup(h){const{agentHistory:A}=K(),I=F(),v=o=>{I.push({name:"dialogue",query:{agentId:o}})},u=()=>{I.push({path:"/"})};return(o,_)=>{const g=w("svg-icon"),y=w("el-scrollbar");return c(),d("div",ie,[t("div",{class:"logo-box"},[t("img",{src:oe,class:"logo",onClick:u})]),t("div",re,[l(y,null,{default:U(()=>[(c(!0),d(b,null,N(q(A),i=>(c(),d("div",{class:J(["item",{active:o.agentId==i.agentId}]),key:i.agentId,onClick:C=>v(i.agentId)},[t("img",{src:i.avatar,class:"agent-logo"},null,8,de),l(g,{name:"agent-active",class:"agent-active"})],10,ce))),128))]),_:1})])])}}});const ue=V(le,[["__scopeId","data-v-8f59ddf0"]]),ge=h=>($("data-v-284553e4"),h=h(),j(),h),_e={class:"dialogue-history"},pe={class:"dialogue-header"},me={class:"history-list"},he={key:0,class:"create"},Ae=ge(()=>t("span",null,"新的对话",-1)),ve=["onClick"],fe={class:"more"},Ie={class:"item-dropdown"},ye={class:"dropdown-menu"},ke=["onClick"],we=["onClick"],Ce=T({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(h,{expose:A,emit:I}){const v=I,u=h,o=F(),_=M(),g=k([]),y=H(()=>_.query.chatId||""),i=async()=>{const{data:a}=await O({agentUUid:u.agentId});g.value=p(a)},C=a=>{v("refreshHistory"),o.push({name:"dialogue",query:{agentId:u.agentId,chatId:a.id}})};function p(a){const D=new Date,R=new Date(D.getTime()-6*24*60*60*1e3),Q=a.reduce((s,m)=>{const n=new Date(m.createAt),f=`${n.getFullYear()}-${n.getMonth()+1}`;return n>=R&&n<=D?(s.近7天||(s.近7天=[]),s.近7天.push(m)):(s[f]||(s[f]=[]),s[f].push(m)),s},{});return Object.entries(Q).map(([s,m])=>{const n=s==="近7天",f=!n;let r="";if(n)r="近7天";else if(f){const[x,G]=s.split("-").map(Number),B=new Date().getFullYear();x!==B?r=`${x}年${G}月`:r=`${G}月`}return{title:r,items:m}})}const e=()=>{v("refreshHistory"),o.push({name:"dialogue",query:{agentId:u.agentId}})},S=a=>{ne.prompt("","自定义历史会话标题",{}).then(async D=>{await ee({chatId:a.id,customTitle:D.value,top:!1}),i()})},X=async a=>{await te({chatId:a.id}),o.push({name:"dialogue",query:{agentId:u.agentId}})};return W(()=>u.agentId,a=>{a&&i()},{immediate:!0}),A({getAgentChatHistory:i}),(a,D)=>{var m;const R=w("svg-icon"),Q=w("el-text"),Y=w("el-popover"),s=w("el-scrollbar");return c(),d("div",_e,[t("div",pe,[t("h3",null,[L(E((m=a.agentInfo)==null?void 0:m.name)+" ",1),l(R,{name:"Edit",class:"edit-icon",onClick:e})]),t("p",null,[l(Q,{"line-clamp":2},{default:U(()=>{var n;return[L(E((n=a.agentInfo)==null?void 0:n.intro),1)]}),_:1})])]),t("div",me,[y.value?Z("",!0):(c(),d("div",he,[l(R,{name:"new-dialogue",class:"create-icon"}),Ae])),l(s,null,{default:U(()=>[(c(!0),d(b,null,N(g.value,(n,f)=>(c(),d("div",{class:"list",key:f},[t("h4",null,E(n.title),1),(c(!0),d(b,null,N(n.items,r=>(c(),d("div",{class:J(["item",{active:y.value==r.id}]),key:r.id,onClick:x=>C(r)},[t("span",null,E(r.title),1),t("div",fe,[l(Y,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:U(()=>[t("div",Ie,[l(R,{name:"more",class:"more-icon"})])]),default:U(()=>[t("div",ye,[t("div",{class:"dropdown-item",onClick:P(x=>S(r),["stop"])},"自定义标题",8,ke),t("div",{class:"dropdown-item del",onClick:P(x=>X(r),["stop"])},"删除",8,we)])]),_:2},1024)])],10,ve))),128))]))),128))]),_:1})])])}}});const De=V(Ce,[["__scopeId","data-v-284553e4"]]),Re={class:"dialogue-container"},xe={key:0,class:"aside-container"},Ue=T({__name:"index",setup(h){const A=M(),{setAgentHistory:I}=K(),v=k();let u=k("");const o=k();let _=k(!0);const g=k(""),y=H(()=>A.query.chatId||""),i=async p=>{const{data:e}=await se(p);e.background&&(u.value=e.background),localStorage.setItem("agentUuid",e.agentUuid),localStorage.setItem("users_id",e.uid),e.uuid=e.agentUuid,g.value=e.agentUuid,e.guides=e.guides.map(S=>({guide:S})),o.value=e,I({avatar:e==null?void 0:e.avatar,name:e==null?void 0:e.name,agentId:e.agentUuid})};z(()=>{window.innerWidth<=1200?_.value=!1:window.innerWidth>1200&&(_.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?_.value=!1:window.innerWidth>1200&&(_.value=!0)})});const C=()=>{v.value.getAgentChatHistory()};return W(()=>[A.query.hash,A.query.agentId],p=>{p[0]?i({hash:p[0]}):i({agentUUid:p[1]})},{immediate:!0}),(p,e)=>(c(),d("div",Re,[q(_)===!0?(c(),d("div",xe,[l(ue,{agentId:g.value},null,8,["agentId"]),l(De,{ref_key:"dialogueListRef",ref:v,agentInfo:o.value,agentId:g.value,onRefreshHistory:C},null,8,["agentInfo","agentId"])])):Z("",!0),l(ae,{class:"chat-container",agentId:g.value,chatId:y.value,agentData:o.value,onRefreshHistory:C},null,8,["agentId","chatId","agentData"])]))}});const Le=V(Ue,[["__scopeId","data-v-1153c995"]]);export{Le as default};
