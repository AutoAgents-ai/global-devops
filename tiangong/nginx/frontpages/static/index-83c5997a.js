import{H as Y,aJ as q,ah as C,l as r,m as l,p as e,u as b,V as o,P as U,F as N,a8 as T,J,aG as M,r as E,e as W,d as Z,T as P,U as x,O as j,S as V,aD as z,aE as O,a3 as F,c as ee}from"./vue-82a6b7fc.js";import{u as B,a as te,b as ne,d as se,C as ae}from"./index-67bdf510.js";import{_ as G}from"./index-08b0dd87.js";import{h as oe}from"./element-4990942a.js";import{l as ie}from"./agent-3c44101a.js";import"./agent-f15e943f.js";import"./index-ebc61d5c.js";import"./vxe-45effba2.js";const ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBzVg9bNNQEP5eYOkPUiSK2gkZCQk22q7NkA6FbgWVhYkgYGJATF2AthudiIANqjQLLCDajR+JGqldqbtRCYRhAgmkDBQmKPfl2cFxnh07adJ+0sXOy8n35e7evTsrpES+sGPJZUpkmF9Fsp4QFRHXE1tkxV5SLlJAJVUUIgW5XPRIpIEjVop2SZWTKDclJETycimJWGgPrliba0ZMxRBhGOZErmN3URSZl1BWkJSQlyfPofOkE3BFxk35pSLIrKL9EDWDCwMpFSLDMG10gYwPxyNVC18mpDDXRTIEU2I2uFDzkLetS9gb0Es2bw4GFmdNmv29Wkz4+UtLEEMDyXUDoCOO8abqoTjvTJ8Gzk+Yn0LjznugvAKMjQCTuf/GTYSuziIaCgXWKN9DkbVmUwxuGwx8/Q58+CJERoGZy/r7ldvAoT7g+FEzoVjsoCCfZeVt809RevRQbqRx3Q9leVm8tAU8nNek6DUSNRG6dR+xyByARQ9NxSl9lIf39zSub25pAndnxNgT4Okr7Rka5R/o620k1Ax//+Ast30+TsmU0FxjmJgzC4vAtQvAy3XZwye1pwYH0CqG6SErTmPtnZYwnr3WxpnUVdI7+vrgsf6tReQzaLEQMlwkOni4PhxtkCGyJJTF/kE2g30GEqqgRURV8DZQaZkQ602wAA4d0fUnN4p24HKX2SKFKA1u5VMn6tfoGd8w75ncPDpYAliXeM+kD4KJnyDhXXrIidMwhYUPv/NIGyAx/0ryPK/CZFLApofkaKz2uZGEaCgMEmDYSI4F8saC9s70hJlQQpIr/mnPljVv0qDRcMh8A99+yFw0pQm9WNOnPuuSqWUh8fUNxMGRnmjEP+3LUYQmx4AzOfMT/Pbj5j3tMVZu33gYTQkpHaVgx8gT3wrr8Z/29Zifsf270Tg9FAV6NAKueKfaoAU7xkvQ00YdmnR6aYxGQ1V7+SpqldrraYvoPurG7PDRwSxw0D24ns0a6gh589E5T7EbZMbDI3XD4epNkuPoLCl/QHTDPxhPe0+RnXQncqoYRYZI8jqmAD2zWWgPrpJRZ7Wk3sYppX1hxXEp7RsRW6ws7doLKzQSs6AnlTy01yjBV3oV6A7CkbFm+c2i+owU+AdOuB7Rr1KudAAAAABJRU5ErkJggg==",re={class:"aside-angent"},de={class:"logo-box"},le={class:"agent-box"},ue=["onClick"],ge=["src"],_e=Y({__name:"Aside",props:{agentId:{}},setup(A){const{agentHistory:v}=B(),f=q(),y=s=>{f.push({name:"dialogue",query:{agentId:s}})};return(s,i)=>{const _=C("svg-icon"),k=C("el-scrollbar");return r(),l("div",re,[e("div",de,[e("img",{src:ce,class:"logo",onClick:i[0]||(i[0]=(...a)=>b(f).back&&b(f).back(...a))})]),e("div",le,[o(k,null,{default:U(()=>[(r(!0),l(N,null,T(b(v),a=>(r(),l("div",{class:J(["item",{active:s.agentId==a.agentId}]),key:a.agentId,onClick:I=>y(a.agentId)},[e("img",{src:a.avatar,class:"agent-logo"},null,8,ge),o(_,{name:"agent-active",class:"agent-active"})],10,ue))),128))]),_:1})])])}}});const pe=G(_e,[["__scopeId","data-v-8f6984f7"]]),H=A=>(z("data-v-bef44732"),A=A(),O(),A),me={class:"dialogue-history"},he={class:"dialogue-header"},Ae={class:"history-list"},ve={key:0,class:"create"},fe=H(()=>e("span",null,"新的对话",-1)),Ie=["onClick"],ye={class:"more"},ke={class:"item-dropdown"},we={class:"dropdown-menu"},Ce=["onClick"],De=["onClick"],Re={class:"agent-footer"},xe={class:"link"},Ue={class:"item"},Ee={class:"item"},be={class:"item"},Qe=H(()=>e("p",null,"V 1.0",-1)),Se=Y({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(A,{expose:v,emit:f}){const y=f,s=A,i=q(),_=M(),k=E([]),a=W(()=>_.query.chatId||""),I=async()=>{const{data:n}=await te({agentUUid:s.agentId});k.value=t(n)},p=n=>{y("refreshHistory"),i.push({name:"dialogue",query:{agentId:s.agentId,chatId:n.id}})};function t(n){const D=new Date,m=new Date(D.getTime()-6*24*60*60*1e3),S=n.reduce((c,h)=>{const u=new Date(h.createAt),d=`${u.getFullYear()}-${u.getMonth()+1}`;return u>=m&&u<=D?(c.近7天||(c.近7天=[]),c.近7天.push(h)):(c[d]||(c[d]=[]),c[d].push(h)),c},{});return Object.entries(S).map(([c,h])=>{const u=c==="近7天",d=!u;let w="";if(u)w="近7天";else if(d){const[g,R]=c.split("-").map(Number),$=new Date().getFullYear();g!==$?w=`${g}年${R}月`:w=`${R}月`}return{title:w,items:h}})}const Q=()=>{i.push({name:"dialogue",query:{agentId:s.agentId}})},K=n=>{oe.prompt("","自定义历史会话标题",{}).then(async D=>{await ne({chatId:n.id,customTitle:D.value,top:!1}),I()})},X=async n=>{await se({chatId:n.id}),i.push({name:"dialogue",query:{agentId:s.agentId}})};return Z(()=>s.agentId,n=>{n&&I()},{immediate:!0}),v({getAgentChatHistory:I}),(n,D)=>{var h,u;const m=C("svg-icon"),S=C("el-text"),L=C("el-popover"),c=C("el-scrollbar");return r(),l("div",me,[e("div",he,[e("h3",null,[P(x((h=n.agentInfo)==null?void 0:h.name)+" ",1),a.value?(r(),j(m,{key:0,name:"Edit",class:"edit-icon",onClick:Q})):V("",!0)]),e("p",null,[o(S,{"line-clamp":2},{default:U(()=>{var d;return[P(x((d=n.agentInfo)==null?void 0:d.intro),1)]}),_:1})])]),e("div",Ae,[a.value?V("",!0):(r(),l("div",ve,[o(m,{name:"new-dialogue",class:"create-icon"}),fe])),o(c,null,{default:U(()=>[(r(!0),l(N,null,T(k.value,(d,w)=>(r(),l("div",{class:"list",key:w},[e("h4",null,x(d.title),1),(r(!0),l(N,null,T(d.items,g=>(r(),l("div",{class:J(["item",{active:a.value==g.id}]),key:g.id,onClick:R=>p(g)},[e("span",null,x(g.title),1),e("div",ye,[o(L,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:U(()=>[e("div",ke,[o(m,{name:"more",class:"more-icon"})])]),default:U(()=>[e("div",we,[e("div",{class:"dropdown-item",onClick:F(R=>K(g),["stop"])},"自定义标题",8,Ce),e("div",{class:"dropdown-item del",onClick:F(R=>X(g),["stop"])},"删除",8,De)])]),_:2},1024)])],10,Ie))),128))]))),128))]),_:1})]),e("div",Re,[e("div",xe,[e("div",Ue,[o(m,{name:"agent-footer-icon1"})]),e("div",Ee,[o(m,{name:"agent-footer-icon2"})]),e("div",be,[o(m,{name:"agent-footer-icon3"})])]),e("p",null,x((u=n.agentInfo)==null?void 0:u.name),1),Qe])])}}});const Ne=G(Se,[["__scopeId","data-v-bef44732"]]),Te={class:"dialogue-container"},Ve={key:0,class:"aside-container"},Ye=Y({__name:"index",setup(A){const v=M(),{setAgentHistory:f}=B(),y=E(),s=E();let i=E(!0);const _=E(""),k=W(()=>v.query.chatId||""),a=async p=>{const{data:t}=await ie(p);t.uuid=t.agentUuid,_.value=t.agentUuid,t.guides=t.guides.map(Q=>({guide:Q})),s.value=t,f({avatar:t==null?void 0:t.avatar,name:t==null?void 0:t.name,agentId:t.agentUuid})};ee(()=>{window.innerWidth<=1200?i.value=!1:window.innerWidth>1200&&(i.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?i.value=!1:window.innerWidth>1200&&(i.value=!0)})});const I=()=>{y.value.getAgentChatHistory()};return Z(()=>[v.query.hash,v.query.agentId],p=>{p[0]?a({hash:p[0]}):a({agentUUid:p[1]})},{immediate:!0}),(p,t)=>(r(),l("div",Te,[b(i)===!0?(r(),l("div",Ve,[o(pe,{agentId:_.value},null,8,["agentId"]),o(Ne,{ref_key:"dialogueListRef",ref:y,agentInfo:s.value,agentId:_.value,onRefreshHistory:I},null,8,["agentInfo","agentId"])])):V("",!0),o(ae,{class:"chat-container",agentId:_.value,chatId:k.value,agentData:s.value,onRefreshHistory:I},null,8,["agentId","chatId","agentData"])]))}});const Ze=G(Ye,[["__scopeId","data-v-ef22da49"]]);export{Ze as default};
