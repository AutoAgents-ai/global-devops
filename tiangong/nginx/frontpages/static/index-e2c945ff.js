import{H as P,r as c,d as oe,ah as r,ar as se,Q as ne,u as B,l as f,O as $,P as l,I as re,aD as ie,_ as R,m as F,p as o,V as t,F as z,a8 as O,aF as ce,aG as de,U as q,T as ue,a3 as E}from"./vue-6e387ee8.js";import{f as pe,D as me,u as _e}from"./useRequire-2f3f1dbd.js";import{g as fe,G as ve,a as ge,s as he,K as be,d as we}from"./index-9cf2faf9.js";import{u as G,a as ye}from"./knowledge-9f176911.js";import{k as ke,f as Ce}from"./element-3f409242.js";import{_ as xe}from"./index-f817ca3a.js";import"./vxe-e514f80f.js";const Ue=P({__name:"index",props:{files:{type:Array,default:()=>[]},accept:{type:String,default:""},showFileList:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},numLimit:{type:Number,default:1},fileSize:{type:Number,default:10},audioBaseUrl:{type:String,default:"/api/fs/upload"}},emits:["upload-success"],setup(u,{emit:b}){const{proxy:x}=G();let v=b,w=c(!1),g=c(!1),p=c([]),y=c("");const m=u;oe(()=>[m.files],()=>{Array.isArray(m.files)&&m.files.length>0?(p.value=JSON.parse(JSON.stringify(m.files)),y.value=p.value[0].url):p.value=[]},{deep:!0,immediate:!0});const k=i=>(y.value=i.url,w.value=!0,!0),U=i=>{const d=i.size/1024/1024<m.fileSize;return e(i),d||(x.$message.error(`上传文件大小不能超过 ${m.fileSize}MB!`),p.value=[]),d},D=()=>!0,S=i=>{g.value=!0;const d=new FormData;d.append("file",i.file),pe(d,{returnType:"url"}).then(_=>{v("upload-success",_.data),x.$message.success("上传成功"),g.value=!1}).catch(()=>{g.value=!1})},e=i=>{var d=i,_=URL.createObjectURL(d),C=new Audio(_);C.addEventListener("loadedmetadata",()=>{})};return(i,d)=>{const _=r("el-upload"),C=se("loading");return ne((f(),$(_,{id:"audioUpload",class:"avatar-uploader",action:"#","show-file-list":u.showFileList,multiple:u.multiple,"file-list":B(p),limit:u.numLimit,accept:u.accept,"http-request":S,"before-upload":U,"before-remove":D,"on-preview":k},{default:l(()=>[re(i.$slots,"default")]),_:3},8,["show-file-list","multiple","file-list","limit","accept"])),[[C,B(g)]])}}}),Se=u=>(ce("data-v-935c0921"),u=u(),de(),u),Ve={class:"app-container"},Fe={class:"app-list"},$e={class:"app-list-box"},Be={class:"add-icon"},De=Se(()=>o("h3",null,"创建知识库",-1)),Ie=["onClick"],Le={class:"image-slot"},Me={class:"item-dropdown"},Ae={class:"dropdown-menu"},Ke=["onClick"],Ne=["onClick"],Te={class:"avatar"},Re={class:"imgiconbox"},ze=["src"],Oe=P({__name:"index",setup(u){const{proxy:b}=G(),x=ie(),v=c(!1),w=c(!0),g=c(0),p=c(),y=c(),m=c(),k=c(!1),U=c("创建知识库"),D={pageNum:1,pageSize:10,count:!0,keywords:"",parentId:0},S=c([]),e=R({parentId:0,name:"",vectorModel:"SkyChat-MegaVerse",avatarUrl:"",tags:[],type:"kb",description:""}),i=R({name:[{required:!0,message:"请填写知识库名称!",trigger:"blur"}],type:[{required:!0,message:"请填写知识库描述!",trigger:"blur"}]}),d=()=>{fe(D).then(s=>{S.value=s.data.list})};d();const _=()=>{ve("emb_models").then(s=>{y.value=s.data})};_();const C=()=>{v.value=!0,w.value=!0,k.value=!1},J=s=>{w.value=!1,v.value=!0,k.value=!0,g.value=s,U.value="知识库设置",be(s).then(n=>{let h;for(h in e)e.hasOwnProperty(h)&&(e[h]=n.data[h]);e.vectorModel})},Q=s=>{Ce.confirm("此操作将永久删除数据,是否继续?","提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{we(s).then(n=>{d(),b.$message.success("删除成功!")})}).catch(()=>{})},j=s=>{e.avatarUrl=s},H=async()=>{await p.value.validate(async s=>{s&&(w.value?await ge(e).then(()=>{b.$message.success("创建成功!")}):await he(Object.assign(e,{id:g.value})).then(()=>{b.$message.success("修改成功!")}),await d(),await _(),await L(),v.value=!1)})},L=()=>{e.avatarUrl="",p.value.resetFields()},W=(s,n)=>{m.value=s,ye().setChatData(n),x.push({name:"knowledgeTable"})};return(s,n)=>{const h=r("Plus"),M=r("el-icon"),A=r("el-col"),X=r("el-image"),Y=r("el-text"),K=r("svg-icon"),Z=r("el-popover"),ee=r("el-row"),I=r("el-input"),V=r("el-form-item"),te=r("el-option"),ae=r("el-select"),le=r("el-form");return f(),F("div",null,[o("div",Ve,[o("div",Fe,[o("div",$e,[t(ee,{gutter:24},{default:l(()=>[t(A,{span:6},{default:l(()=>[o("div",{class:"item add",onClick:C},[o("div",Be,[t(M,{size:20},{default:l(()=>[t(h)]),_:1})]),De])]),_:1}),(f(!0),F(z,null,O(S.value,(a,N)=>(f(),$(A,{span:6,key:N},{default:l(()=>[o("div",{class:"item",onClick:T=>W(N,a)},[t(X,{src:a.avatarUrl?a.avatarUrl:`${B(_e)("")}`,class:"logo"},{error:l(()=>[o("div",Le,[t(M,null,{default:l(()=>[t(B(ke))]),_:1})])]),_:2},1032,["src"]),o("h3",null,q(a.name),1),o("p",null,[t(Y,{"line-clamp":2},{default:l(()=>[ue(q(a.description),1)]),_:2},1024)]),t(Z,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:100,trigger:"hover",offset:0},{reference:l(()=>[o("div",Me,[t(K,{name:"more",class:"icon"})])]),default:l(()=>[o("div",Ae,[o("div",{class:"dropdown-item",onClick:E(T=>J(a.id),["stop"])},"编辑",8,Ke),o("div",{class:"dropdown-item del",onClick:E(T=>Q(a.id),["stop"])},"删除",8,Ne)])]),_:2},1024)],8,Ie)]),_:2},1024))),128))]),_:1})])])]),t(me,{visible:v.value,"onUpdate:visible":n[4]||(n[4]=a=>v.value=a),title:U.value,onConfirm:H,onClose:L,width:"640px"},{main:l(()=>[o("div",Te,[t(Ue,{onUploadSuccess:j},{default:l(()=>[o("div",Re,[e.avatarUrl?(f(),F("img",{key:1,src:e.avatarUrl,alt:""},null,8,ze)):(f(),$(K,{key:0,name:"ImgAdd",class:"imgaddicon"}))])]),_:1})]),t(le,{ref_key:"ruleFormRef",ref:p,model:e,"status-icon":"",rules:i,"label-position":"top","label-width":"80px",class:"demo-ruleForm"},{default:l(()=>[t(V,{label:"知识库名称",prop:"name"},{default:l(()=>[t(I,{modelValue:e.name,"onUpdate:modelValue":n[0]||(n[0]=a=>e.name=a)},null,8,["modelValue"])]),_:1}),t(V,{label:"知识库描述",prop:"description"},{default:l(()=>[t(I,{modelValue:e.description,"onUpdate:modelValue":n[1]||(n[1]=a=>e.description=a),type:"textarea",rows:4,placeholder:"请输入对此知识库的描述"},null,8,["modelValue"])]),_:1}),t(V,{label:"索引模型",prop:"vectorModel"},{default:l(()=>[t(ae,{modelValue:e.vectorModel,"onUpdate:modelValue":n[2]||(n[2]=a=>e.vectorModel=a),placeholder:"选择",disabled:k.value},{default:l(()=>[(f(!0),F(z,null,O(y.value,a=>(f(),$(te,{label:a.name,value:a.model},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1}),t(V,{label:"标签",prop:"tags"},{default:l(()=>[t(I,{modelValue:e.tags[0],"onUpdate:modelValue":n[3]||(n[3]=a=>e.tags[0]=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title"])])}}});const He=xe(Oe,[["__scopeId","data-v-935c0921"]]);export{He as default};
