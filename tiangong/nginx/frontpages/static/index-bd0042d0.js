import{H as T,aJ as q,ah as w,l as c,m as d,p as t,V as l,P as U,F as b,a8 as N,u as J,J as M,aG as H,r as k,e as W,d as Z,T as L,U as E,S as K,aD as j,aE as z,a3 as P,c as O}from"./vue-3e7b265f.js";import{u as X,a as ee,b as te,d as ae,C as se}from"./index-0f64a9b5.js";import{_ as V,f as F}from"./index-b1d3f3dc.js";import{f as ne}from"./element-f6a868e5.js";import{l as oe}from"./agent-dd92bfaf.js";import"./agent-1c61cb0f.js";import"./index-2a9b20e7.js";import"./steer-603cdc5c.js";import"./vxe-49ae37d0.js";const ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBzVg9bNNQEP5eYOkPUiSK2gkZCQk22q7NkA6FbgWVhYkgYGJATF2AthudiIANqjQLLCDajR+JGqldqbtRCYRhAgmkDBQmKPfl2cFxnh07adJ+0sXOy8n35e7evTsrpES+sGPJZUpkmF9Fsp4QFRHXE1tkxV5SLlJAJVUUIgW5XPRIpIEjVop2SZWTKDclJETycimJWGgPrliba0ZMxRBhGOZErmN3URSZl1BWkJSQlyfPofOkE3BFxk35pSLIrKL9EDWDCwMpFSLDMG10gYwPxyNVC18mpDDXRTIEU2I2uFDzkLetS9gb0Es2bw4GFmdNmv29Wkz4+UtLEEMDyXUDoCOO8abqoTjvTJ8Gzk+Yn0LjznugvAKMjQCTuf/GTYSuziIaCgXWKN9DkbVmUwxuGwx8/Q58+CJERoGZy/r7ldvAoT7g+FEzoVjsoCCfZeVt809RevRQbqRx3Q9leVm8tAU8nNek6DUSNRG6dR+xyByARQ9NxSl9lIf39zSub25pAndnxNgT4Okr7Rka5R/o620k1Ax//+Ast30+TsmU0FxjmJgzC4vAtQvAy3XZwye1pwYH0CqG6SErTmPtnZYwnr3WxpnUVdI7+vrgsf6tReQzaLEQMlwkOni4PhxtkCGyJJTF/kE2g30GEqqgRURV8DZQaZkQ602wAA4d0fUnN4p24HKX2SKFKA1u5VMn6tfoGd8w75ncPDpYAliXeM+kD4KJnyDhXXrIidMwhYUPv/NIGyAx/0ryPK/CZFLApofkaKz2uZGEaCgMEmDYSI4F8saC9s70hJlQQpIr/mnPljVv0qDRcMh8A99+yFw0pQm9WNOnPuuSqWUh8fUNxMGRnmjEP+3LUYQmx4AzOfMT/Pbj5j3tMVZu33gYTQkpHaVgx8gT3wrr8Z/29Zifsf270Tg9FAV6NAKueKfaoAU7xkvQ00YdmnR6aYxGQ1V7+SpqldrraYvoPurG7PDRwSxw0D24ns0a6gh589E5T7EbZMbDI3XD4epNkuPoLCl/QHTDPxhPe0+RnXQncqoYRYZI8jqmAD2zWWgPrpJRZ7Wk3sYppX1hxXEp7RsRW6ws7doLKzQSs6AnlTy01yjBV3oV6A7CkbFm+c2i+owU+AdOuB7Rr1KudAAAAABJRU5ErkJggg==",re={class:"aside-angent"},ce={class:"agent-box"},de=["onClick"],le=["src"],ue=T({__name:"Aside",props:{agentId:{}},setup(h){const{agentHistory:A}=X(),I=q(),v=o=>{I.push({name:"dialogue",query:{agentId:o}})},u=()=>{I.push({path:"/"})};return(o,p)=>{const g=w("svg-icon"),y=w("el-scrollbar");return c(),d("div",re,[t("div",{class:"logo-box"},[t("img",{src:ie,class:"logo",onClick:u})]),t("div",ce,[l(y,null,{default:U(()=>[(c(!0),d(b,null,N(J(A),i=>(c(),d("div",{class:M(["item",{active:o.agentId==i.agentId}]),key:i.agentId,onClick:C=>v(i.agentId)},[t("img",{src:i.avatar,class:"agent-logo"},null,8,le),l(g,{name:"agent-active",class:"agent-active"})],10,de))),128))]),_:1})])])}}});const ge=V(ue,[["__scopeId","data-v-8f59ddf0"]]),pe=h=>(j("data-v-284553e4"),h=h(),z(),h),_e={class:"dialogue-history"},me={class:"dialogue-header"},he={class:"history-list"},Ae={key:0,class:"create"},ve=pe(()=>t("span",null,"新的对话",-1)),fe=["onClick"],Ie={class:"more"},ye={class:"item-dropdown"},ke={class:"dropdown-menu"},we=["onClick"],Ce=["onClick"],De=T({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(h,{expose:A,emit:I}){const v=I,u=h,o=q(),p=H(),g=k([]),y=W(()=>p.query.chatId||""),i=async()=>{const{data:a}=await ee({agentUUid:u.agentId});g.value=_(a)},C=a=>{v("refreshHistory"),o.push({name:"dialogue",query:{agentId:u.agentId,chatId:a.id}})};function _(a){const D=new Date,R=new Date(D.getTime()-6*24*60*60*1e3),S=a.reduce((n,m)=>{const s=new Date(m.createAt),f=`${s.getFullYear()}-${s.getMonth()+1}`;return s>=R&&s<=D?(n.近7天||(n.近7天=[]),n.近7天.push(m)):(n[f]||(n[f]=[]),n[f].push(m)),n},{});return Object.entries(S).map(([n,m])=>{const s=n==="近7天",f=!s;let r="";if(s)r="近7天";else if(f){const[x,G]=n.split("-").map(Number),$=new Date().getFullYear();x!==$?r=`${x}年${G}月`:r=`${G}月`}return{title:r,items:m}})}const e=()=>{v("refreshHistory"),o.push({name:"dialogue",query:{agentId:u.agentId}})},Q=a=>{ne.prompt("","自定义历史会话标题",{}).then(async D=>{await te({chatId:a.id,customTitle:D.value,top:!1}),i()})},B=async a=>{await ae({chatId:a.id}),o.push({name:"dialogue",query:{agentId:u.agentId}})};return Z(()=>u.agentId,a=>{a&&i()},{immediate:!0}),A({getAgentChatHistory:i}),(a,D)=>{var m;const R=w("svg-icon"),S=w("el-text"),Y=w("el-popover"),n=w("el-scrollbar");return c(),d("div",_e,[t("div",me,[t("h3",null,[L(E((m=a.agentInfo)==null?void 0:m.name)+" ",1),l(R,{name:"Edit",class:"edit-icon",onClick:e})]),t("p",null,[l(S,{"line-clamp":2},{default:U(()=>{var s;return[L(E((s=a.agentInfo)==null?void 0:s.intro),1)]}),_:1})])]),t("div",he,[y.value?K("",!0):(c(),d("div",Ae,[l(R,{name:"new-dialogue",class:"create-icon"}),ve])),l(n,null,{default:U(()=>[(c(!0),d(b,null,N(g.value,(s,f)=>(c(),d("div",{class:"list",key:f},[t("h4",null,E(s.title),1),(c(!0),d(b,null,N(s.items,r=>(c(),d("div",{class:M(["item",{active:y.value==r.id}]),key:r.id,onClick:x=>C(r)},[t("span",null,E(r.title),1),t("div",Ie,[l(Y,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:U(()=>[t("div",ye,[l(R,{name:"more",class:"more-icon"})])]),default:U(()=>[t("div",ke,[t("div",{class:"dropdown-item",onClick:P(x=>Q(r),["stop"])},"自定义标题",8,we),t("div",{class:"dropdown-item del",onClick:P(x=>B(r),["stop"])},"删除",8,Ce)])]),_:2},1024)])],10,fe))),128))]))),128))]),_:1})])])}}});const Re=V(De,[["__scopeId","data-v-284553e4"]]),xe={class:"dialogue-container"},Ue={key:0,class:"aside-container"},Ee=T({__name:"index",setup(h){const A=H(),{setAgentHistory:I}=X(),v=k();let u=k("");const o=k();let p=k(!0);const g=k(""),y=W(()=>A.query.chatId||""),i=async _=>{const{data:e}=await oe(_);e.background&&(u.value=e.background),F.set("agentUuid",e.agentUuid),F.set("users_id",e.uid),e.uuid=e.agentUuid,g.value=e.agentUuid,e.guides=e.guides.map(Q=>({guide:Q})),o.value=e,I({avatar:e==null?void 0:e.avatar,name:e==null?void 0:e.name,agentId:e.agentUuid})};O(()=>{window.innerWidth<=1200?p.value=!1:window.innerWidth>1200&&(p.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?p.value=!1:window.innerWidth>1200&&(p.value=!0)})});const C=()=>{v.value.getAgentChatHistory()};return Z(()=>[A.query.hash,A.query.agentId],_=>{_[0]?i({hash:_[0]}):i({agentUUid:_[1]})},{immediate:!0}),(_,e)=>(c(),d("div",xe,[J(p)===!0?(c(),d("div",Ue,[l(ge,{agentId:g.value},null,8,["agentId"]),l(Re,{ref_key:"dialogueListRef",ref:v,agentInfo:o.value,agentId:g.value,onRefreshHistory:C},null,8,["agentInfo","agentId"])])):K("",!0),l(se,{class:"chat-container",agentId:g.value,chatId:y.value,agentData:o.value,onRefreshHistory:C},null,8,["agentId","chatId","agentData"])]))}});const Pe=V(Ee,[["__scopeId","data-v-a31e85c3"]]);export{Pe as default};
