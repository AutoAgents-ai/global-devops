import{H as V,aJ as F,ah as w,l as i,m as l,p as t,V as u,P as R,F as S,a8 as N,u as q,J,aG as M,r as x,e as W,d as Z,T as L,U,O as $,S as T,aD as j,aE as z,a3 as P,c as O}from"./vue-82a6b7fc.js";import{u as H,a as ee,b as te,d as ae,C as ne}from"./index-7af3973b.js";import{_ as Y}from"./index-e4a3aec9.js";import{f as se}from"./element-155f1a92.js";import{l as oe}from"./agent-679aa92a.js";import"./agent-0514275e.js";import"./index-d7d711fa.js";import"./vxe-fc542a86.js";const ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANTSURBVHgBzVg9bNNQEP5eYOkPUiSK2gkZCQk22q7NkA6FbgWVhYkgYGJATF2AthudiIANqjQLLCDajR+JGqldqbtRCYRhAgmkDBQmKPfl2cFxnh07adJ+0sXOy8n35e7evTsrpES+sGPJZUpkmF9Fsp4QFRHXE1tkxV5SLlJAJVUUIgW5XPRIpIEjVop2SZWTKDclJETycimJWGgPrliba0ZMxRBhGOZErmN3URSZl1BWkJSQlyfPofOkE3BFxk35pSLIrKL9EDWDCwMpFSLDMG10gYwPxyNVC18mpDDXRTIEU2I2uFDzkLetS9gb0Es2bw4GFmdNmv29Wkz4+UtLEEMDyXUDoCOO8abqoTjvTJ8Gzk+Yn0LjznugvAKMjQCTuf/GTYSuziIaCgXWKN9DkbVmUwxuGwx8/Q58+CJERoGZy/r7ldvAoT7g+FEzoVjsoCCfZeVt809RevRQbqRx3Q9leVm8tAU8nNek6DUSNRG6dR+xyByARQ9NxSl9lIf39zSub25pAndnxNgT4Okr7Rka5R/o620k1Ax//+Ast30+TsmU0FxjmJgzC4vAtQvAy3XZwye1pwYH0CqG6SErTmPtnZYwnr3WxpnUVdI7+vrgsf6tReQzaLEQMlwkOni4PhxtkCGyJJTF/kE2g30GEqqgRURV8DZQaZkQ602wAA4d0fUnN4p24HKX2SKFKA1u5VMn6tfoGd8w75ncPDpYAliXeM+kD4KJnyDhXXrIidMwhYUPv/NIGyAx/0ryPK/CZFLApofkaKz2uZGEaCgMEmDYSI4F8saC9s70hJlQQpIr/mnPljVv0qDRcMh8A99+yFw0pQm9WNOnPuuSqWUh8fUNxMGRnmjEP+3LUYQmx4AzOfMT/Pbj5j3tMVZu33gYTQkpHaVgx8gT3wrr8Z/29Zifsf270Tg9FAV6NAKueKfaoAU7xkvQ00YdmnR6aYxGQ1V7+SpqldrraYvoPurG7PDRwSxw0D24ns0a6gh589E5T7EbZMbDI3XD4epNkuPoLCl/QHTDPxhPe0+RnXQncqoYRYZI8jqmAD2zWWgPrpJRZ7Wk3sYppX1hxXEp7RsRW6ws7doLKzQSs6AnlTy01yjBV3oV6A7CkbFm+c2i+owU+AdOuB7Rr1KudAAAAABJRU5ErkJggg==",re={class:"aside-angent"},ce={class:"agent-box"},de=["onClick"],le=["src"],ue=V({__name:"Aside",props:{agentId:{}},setup(m){const{agentHistory:h}=H(),f=F(),I=n=>{f.push({name:"dialogue",query:{agentId:n}})},r=()=>{f.push({path:"/"})};return(n,A)=>{const y=w("svg-icon"),_=w("el-scrollbar");return i(),l("div",re,[t("div",{class:"logo-box"},[t("img",{src:ie,class:"logo",onClick:r})]),t("div",ce,[u(_,null,{default:R(()=>[(i(!0),l(S,null,N(q(h),c=>(i(),l("div",{class:J(["item",{active:n.agentId==c.agentId}]),key:c.agentId,onClick:g=>I(c.agentId)},[t("img",{src:c.avatar,class:"agent-logo"},null,8,le),u(y,{name:"agent-active",class:"agent-active"})],10,de))),128))]),_:1})])])}}});const ge=Y(ue,[["__scopeId","data-v-a13250e0"]]),_e=m=>(j("data-v-de0603d6"),m=m(),z(),m),pe={class:"dialogue-history"},me={class:"dialogue-header"},he={class:"history-list"},Ae={key:0,class:"create"},ve=_e(()=>t("span",null,"新的对话",-1)),fe=["onClick"],Ie={class:"more"},ye={class:"item-dropdown"},we={class:"dropdown-menu"},ke=["onClick"],Ce=["onClick"],De=V({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(m,{expose:h,emit:f}){const I=f,r=m,n=F(),A=M(),y=x([]),_=W(()=>A.query.chatId||""),c=async()=>{const{data:a}=await ee({agentUUid:r.agentId});y.value=e(a)},g=a=>{I("refreshHistory"),n.push({name:"dialogue",query:{agentId:r.agentId,chatId:a.id}})};function e(a){const k=new Date,C=new Date(k.getTime()-6*24*60*60*1e3),Q=a.reduce((o,p)=>{const s=new Date(p.createAt),v=`${s.getFullYear()}-${s.getMonth()+1}`;return s>=C&&s<=k?(o.近7天||(o.近7天=[]),o.近7天.push(p)):(o[v]||(o[v]=[]),o[v].push(p)),o},{});return Object.entries(Q).map(([o,p])=>{const s=o==="近7天",v=!s;let d="";if(s)d="近7天";else if(v){const[D,G]=o.split("-").map(Number),X=new Date().getFullYear();D!==X?d=`${D}年${G}月`:d=`${G}月`}return{title:d,items:p}})}const E=()=>{n.push({name:"dialogue",query:{agentId:r.agentId}})},B=a=>{se.prompt("","自定义历史会话标题",{}).then(async k=>{await te({chatId:a.id,customTitle:k.value,top:!1}),c()})},K=async a=>{await ae({chatId:a.id}),n.push({name:"dialogue",query:{agentId:r.agentId}})};return Z(()=>r.agentId,a=>{a&&c()},{immediate:!0}),h({getAgentChatHistory:c}),(a,k)=>{var p;const C=w("svg-icon"),Q=w("el-text"),b=w("el-popover"),o=w("el-scrollbar");return i(),l("div",pe,[t("div",me,[t("h3",null,[L(U((p=a.agentInfo)==null?void 0:p.name)+" ",1),_.value?(i(),$(C,{key:0,name:"Edit",class:"edit-icon",onClick:E})):T("",!0)]),t("p",null,[u(Q,{"line-clamp":2},{default:R(()=>{var s;return[L(U((s=a.agentInfo)==null?void 0:s.intro),1)]}),_:1})])]),t("div",he,[_.value?T("",!0):(i(),l("div",Ae,[u(C,{name:"new-dialogue",class:"create-icon"}),ve])),u(o,null,{default:R(()=>[(i(!0),l(S,null,N(y.value,(s,v)=>(i(),l("div",{class:"list",key:v},[t("h4",null,U(s.title),1),(i(!0),l(S,null,N(s.items,d=>(i(),l("div",{class:J(["item",{active:_.value==d.id}]),key:d.id,onClick:D=>g(d)},[t("span",null,U(d.title),1),t("div",Ie,[u(b,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:R(()=>[t("div",ye,[u(C,{name:"more",class:"more-icon"})])]),default:R(()=>[t("div",we,[t("div",{class:"dropdown-item",onClick:P(D=>B(d),["stop"])},"自定义标题",8,ke),t("div",{class:"dropdown-item del",onClick:P(D=>K(d),["stop"])},"删除",8,Ce)])]),_:2},1024)])],10,fe))),128))]))),128))]),_:1})])])}}});const Re=Y(De,[["__scopeId","data-v-de0603d6"]]),xe={class:"dialogue-container"},Ue={key:0,class:"aside-container"},Ee=V({__name:"index",setup(m){const h=M(),{setAgentHistory:f}=H(),I=x(),r=x();let n=x(!0);const A=x(""),y=W(()=>h.query.chatId||""),_=async g=>{const{data:e}=await oe(g);e.uuid=e.agentUuid,A.value=e.agentUuid,e.guides=e.guides.map(E=>({guide:E})),r.value=e,f({avatar:e==null?void 0:e.avatar,name:e==null?void 0:e.name,agentId:e.agentUuid})};O(()=>{window.innerWidth<=1200?n.value=!1:window.innerWidth>1200&&(n.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?n.value=!1:window.innerWidth>1200&&(n.value=!0)})});const c=()=>{I.value.getAgentChatHistory()};return Z(()=>[h.query.hash,h.query.agentId],g=>{g[0]?_({hash:g[0]}):_({agentUUid:g[1]})},{immediate:!0}),(g,e)=>(i(),l("div",xe,[q(n)===!0?(i(),l("div",Ue,[u(ge,{agentId:A.value},null,8,["agentId"]),u(Re,{ref_key:"dialogueListRef",ref:I,agentInfo:r.value,agentId:A.value,onRefreshHistory:c},null,8,["agentInfo","agentId"])])):T("",!0),u(ne,{class:"chat-container",agentId:A.value,chatId:y.value,agentData:r.value,onRefreshHistory:c},null,8,["agentId","chatId","agentData"])]))}});const Le=Y(Ee,[["__scopeId","data-v-ef22da49"]]);export{Le as default};
