import{H as N,aJ as B,ah as k,l as d,m as l,p as t,V as o,P as b,F as q,a8 as S,u as F,J as W,aG as Y,r as C,e as z,d as G,T as M,U as A,S as J,aD as P,aE as Q,a3 as V,c as X}from"./vue-3e7b265f.js";import{u as j,a as Z,b as ee,d as te,C as ae}from"./index-2c52af16.js";import{_ as R}from"./index-e05d8ced.js";import{f as se}from"./element-f6a868e5.js";import{l as ne}from"./agent-27fed884.js";import"./agent-a250efc3.js";import"./index-2a9b20e7.js";import"./steer-1f38d4c2.js";import"./vxe-49ae37d0.js";const oe={class:"aside-angent"},ie={class:"logo-box"},ce={class:"agent-box"},re=["onClick"],de=["src"],le=N({__name:"Aside",props:{agentId:{}},setup(m){const{agentHistory:v}=j(),y=B(),f=i=>{y.push({name:"dialogue",query:{agentId:i}})},_=()=>{y.push({path:"/"})};return(i,g)=>{const u=k("svg-icon"),w=k("el-scrollbar");return d(),l("div",oe,[t("div",ie,[o(u,{name:"LTLogo",color:"#fff",class:"logo",onClick:_})]),t("div",ce,[o(w,null,{default:b(()=>[(d(!0),l(q,null,S(F(v),c=>(d(),l("div",{class:W(["item",{active:i.agentId==c.agentId}]),key:c.agentId,onClick:D=>f(c.agentId)},[t("img",{src:c.avatar,class:"agent-logo"},null,8,de),o(u,{name:"agent-active",class:"agent-active"})],10,re))),128))]),_:1})])])}}});const ue=R(le,[["__scopeId","data-v-c6825f65"]]),_e=m=>(P("data-v-284553e4"),m=m(),Q(),m),ge={class:"dialogue-history"},pe={class:"dialogue-header"},he={class:"history-list"},me={key:0,class:"create"},ve=_e(()=>t("span",null,"新的对话",-1)),fe=["onClick"],Ie={class:"more"},ye={class:"item-dropdown"},we={class:"dropdown-menu"},Ce=["onClick"],ke=["onClick"],De=N({__name:"DialogueList",props:{agentInfo:{},agentId:{}},emits:["refreshHistory"],setup(m,{expose:v,emit:y}){const f=y,_=m,i=B(),g=Y(),u=C([]),w=z(()=>g.query.chatId||""),c=async()=>{const{data:a}=await Z({agentUUid:_.agentId});u.value=p(a)},D=a=>{f("refreshHistory"),i.push({name:"dialogue",query:{agentId:_.agentId,chatId:a.id}})};function p(a){const $=new Date,x=new Date($.getTime()-6*24*60*60*1e3),U=a.reduce((n,h)=>{const s=new Date(h.createAt),I=`${s.getFullYear()}-${s.getMonth()+1}`;return s>=x&&s<=$?(n.近7天||(n.近7天=[]),n.近7天.push(h)):(n[I]||(n[I]=[]),n[I].push(h)),n},{});return Object.entries(U).map(([n,h])=>{const s=n==="近7天",I=!s;let r="";if(s)r="近7天";else if(I){const[H,T]=n.split("-").map(Number),O=new Date().getFullYear();H!==O?r=`${H}年${T}月`:r=`${T}月`}return{title:r,items:h}})}const e=()=>{f("refreshHistory"),i.push({name:"dialogue",query:{agentId:_.agentId}})},L=a=>{se.prompt("","自定义历史会话标题",{}).then(async $=>{await ee({chatId:a.id,customTitle:$.value,top:!1}),c()})},K=async a=>{await te({chatId:a.id}),i.push({name:"dialogue",query:{agentId:_.agentId}})};return G(()=>_.agentId,a=>{a&&c()},{immediate:!0}),v({getAgentChatHistory:c}),(a,$)=>{var h;const x=k("svg-icon"),U=k("el-text"),E=k("el-popover"),n=k("el-scrollbar");return d(),l("div",ge,[t("div",pe,[t("h3",null,[M(A((h=a.agentInfo)==null?void 0:h.name)+" ",1),o(x,{name:"Edit",class:"edit-icon",onClick:e})]),t("p",null,[o(U,{"line-clamp":2},{default:b(()=>{var s;return[M(A((s=a.agentInfo)==null?void 0:s.intro),1)]}),_:1})])]),t("div",he,[w.value?J("",!0):(d(),l("div",me,[o(x,{name:"new-dialogue",class:"create-icon"}),ve])),o(n,null,{default:b(()=>[(d(!0),l(q,null,S(u.value,(s,I)=>(d(),l("div",{class:"list",key:I},[t("h4",null,A(s.title),1),(d(!0),l(q,null,S(s.items,r=>(d(),l("div",{class:W(["item",{active:w.value==r.id}]),key:r.id,onClick:H=>D(r)},[t("span",null,A(r.title),1),t("div",Ie,[o(E,{placement:"bottom-end","show-arrow":!1,teleported:!1,width:120,trigger:"hover",offset:0},{reference:b(()=>[t("div",ye,[o(x,{name:"more",class:"more-icon"})])]),default:b(()=>[t("div",we,[t("div",{class:"dropdown-item",onClick:V(H=>L(r),["stop"])},"自定义标题",8,Ce),t("div",{class:"dropdown-item del",onClick:V(H=>K(r),["stop"])},"删除",8,ke)])]),_:2},1024)])],10,fe))),128))]))),128))]),_:1})])])}}});const $e=R(De,[["__scopeId","data-v-284553e4"]]),xe={class:"dialogue-container"},He={key:0,class:"aside-container"},be=N({__name:"index",setup(m){const v=Y(),{setAgentHistory:y}=j(),f=C();let _=C("");const i=C();let g=C(!0);const u=C(""),w=z(()=>v.query.chatId||""),c=async p=>{const{data:e}=await ne(p);e.background&&(_.value=e.background),localStorage.setItem("agentUuid",e.agentUuid),localStorage.setItem("users_id",e.uid),e.uuid=e.agentUuid,u.value=e.agentUuid,e.guides=e.guides.map(L=>({guide:L})),i.value=e,y({avatar:e==null?void 0:e.avatar,name:e==null?void 0:e.name,agentId:e.agentUuid})};X(()=>{window.innerWidth<=1200?g.value=!1:window.innerWidth>1200&&(g.value=!0),window.addEventListener("resize",()=>{window.innerWidth<=1200?g.value=!1:window.innerWidth>1200&&(g.value=!0)})});const D=()=>{f.value.getAgentChatHistory()};return G(()=>[v.query.hash,v.query.agentId],p=>{p[0]?c({hash:p[0]}):c({agentUUid:p[1]})},{immediate:!0}),(p,e)=>(d(),l("div",xe,[F(g)===!0?(d(),l("div",He,[o(ue,{agentId:u.value},null,8,["agentId"]),o($e,{ref_key:"dialogueListRef",ref:f,agentInfo:i.value,agentId:u.value,onRefreshHistory:D},null,8,["agentInfo","agentId"])])):J("",!0),o(ae,{class:"chat-container",agentId:u.value,chatId:w.value,agentData:i.value,onRefreshHistory:D},null,8,["agentId","chatId","agentData"])]))}});const Me=R(be,[["__scopeId","data-v-1153c995"]]);export{Me as default};
